# 动手实战SYSTEMD
![](.png)

# 实验目的
- 学习理解`systemd`管理机制并动手实践相关命令

# 实验环境
```bash
Yanglan@cuc:~$ uname -a
Linux ubuntu 4.13.0-36-generic #40~18.04.4-Ubuntu SMP Fri Feb 16 23:25:58 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux
```	

# 实验过程

### 1-3节
[![asciicast](https://asciinema.org/a/JTcV9J5K95eVYv0toi7qWGvbM.svg)](https://asciinema.org/a/JTcV9J5K95eVYv0toi7qWGvbM)
### 4节
[![asciicast](https://asciinema.org/a/c5FrwUzepjXrILr7jZLLWwqhx.svg)](https://asciinema.org/a/c5FrwUzepjXrILr7jZLLWwqhx)
### 5节
[![asciicast](https://asciinema.org/a/pyNwaobgaQwqZMlhxnuWxiNsl.svg)](https://asciinema.org/a/pyNwaobgaQwqZMlhxnuWxiNsl)
### 6节
[![asciicast](https://asciinema.org/a/8EOzt80mRD0bnRNZz76Ck5MBd.svg)](https://asciinema.org/a/8EOzt80mRD0bnRNZz76Ck5MBd)
### 7节
[![asciicast](https://asciinema.org/a/cRrxUPxLJmKQ7QpGzFwXg6dTY.svg)]()
	

# 实验结果
- 录屏中已经体现

# 自查清单

1. 如何添加一个用户并使其具备sudo执行程序的权限？
	- 通过`adduser username`添加用户
	- 将`username`放到`sudo`用户组即可获得

2. 如何将一个用户添加到一个用户组
	- `sudo adduser username sudo`

3. 如何查看当前系统的分区表和文件系统详细信息
	- 通过`sudo sfdisk -l`或`sudo cfdisk`查看分区表
	- 通过`df -a`或`stat -f`查看文件系统详细信息

4. 如何实现开机自动挂载Virtualbox的共享目录分区
	- 首先在vbox中打开添加共享文件夹,打开自动挂载和固定分配
	- `sudo /media/cdrom/./VBoxLinuxAdditions.run`安装增强功能
	- `sudo mount -t vboxsf shared ~/shared`将共享文件夹挂载到share目录
	- virtualbox中的选项**自动挂载**可以实现开机自动挂载，也可以通过systemd实现
	- 编写文件`my_mount-src_host.automount`
	
	```bash
	[Unit]
	Description=Auto mount shared "src" folder
	
	[Automount]
	Where=~/shared
	DirectoryMode=0775
	Type=vboxsf
	
	[Install]
	WantedBy=multi-user.target

	```
	- 执行`systemd enable my_mount-src_host.automount`

5. 基于LVM（逻辑分卷管理）的分区如何实现动态扩容和缩减容量？

	```bash
	#缩容
	lvreduce --size size dir
	#扩容
	lvextend --size size dir
	```
	
6. 如何通过systemd设置实现在网络连通时运行一个指定脚本，在网络断开时运行另一个脚本？
	- 网络连通启动脚本配置

	
	```bash
	[Unit]
	Description=After network up
	After=network.target network-online.target 	
	[Service]
	Type=oneshot
	ExecStart=_YOUR_SCRIPT_
	
	[Install]
	WantedBy=multi-user.target

	```
	
	- 网络断开启动脚本配置，我是将上述文件中的`After`改成`Before`

7. 如何通过systemd设置实现一个脚本在任何情况下被杀死之后会立即重新启动？实现杀不死？
	- 创建service文件
	
		```bash
		[Unit]
		Description=My Script
		
		[Service]
		Type=forking
		ExecStart=/usr/bin/MY_SCRIPT
		ExecStop=/usr/bin/MY_SCRIPT
		Restart=always
		RestartSec=1
		RemainAfterExit=yes
		
		[Install]
		WantedBy=multi-user.target
		```
	- 重新加载配置,并启动，其中在MY_SCRIPT中添加一句`systemd start my_script.service`,再次避免services被停止

    # 参考资料
    [systemd入门教程](http://www.ruanyifeng.com/blog/2016/03/systemd-tutorial-part-two.html)
